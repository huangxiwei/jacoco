---
layout: default
title: Home
---

<h2>Credits</h2>

<ul>
<li>This project is a fork of the main JaCoCo project (<a href="https://github.com/jacoco/jacoco">https://github.com/jacoco/jacoco</a>)
</ul>

<h2>Download</h2>

<h3>JaCoCo</h2>

<ul>
<li><a href="http://mchr3k-eclipse.appspot.com/files/jacoco-0.6.2.201301080920.zip">jacoco-0.6.2.201301080920.zip</a> (08/01/2013)
</ul>

<h3>EclEmma</h2>

<p>Update site: http://mchr3k-eclipse.appspot.com/

<h2>JaCoCo User Guide</h2>

<h3>Source Directives</h3>

<p>The new default filters listed under Features below are always enabled.

<p>Source directives allow coverage to be turned on/off in arbitrary sections of code. The following directives are supported:

<pre>
///COVERAGE:OFF
///COVERAGE:ON</pre>

<p>To allow for easy migration from Clover the following directives are also recognised:

<pre>
///CLOVER:OFF
///CLOVER:ON</pre>

<p>Source directives are disabled by default. To enable them you must add a new section to your jacoco coverage ant task:

<pre class="prettyprint lang-xml">
&lt;jacoco:report&gt;
  &lt;options&gt;
    &lt;sourcedirectives/&gt;
  &lt;/options&gt;
  &lt;executiondata&gt;
    &lt;file file="${result.exec.file}"/&gt;
  &lt;/executiondata&gt;
  &lt;structure name="JaCoCo Ant Example"&gt;
    &lt;classfiles&gt;
      &lt;fileset dir="${result.classes.dir}"/&gt;
    &lt;/classfiles&gt;
    &lt;sourcefiles encoding="UTF-8"&gt;
      &lt;fileset dir="${src.dir}"/&gt;
    &lt;/sourcefiles&gt;
  &lt;/structure&gt;
  &lt;html destdir="${result.report.dir}"/&gt;
&lt;/jacoco:report&gt;</pre>

<p>By default source directives will only be recognised when directives that turn off coverage are acomapnied by a comment e.g.

<pre>///COVERAGE:OFF because the following code is too simple to bother unit testing.</pre>

<p>This requirement can be disabled by adding an extra parameter to the ant task:

<pre class="prettyprint lang-xml">
  &lt;options&gt;
    &lt;sourcedirectives requirecomment="false"/&gt;
  &lt;/options&gt;
</pre>

<h2>EclEmma User Guide</h2>

<p>Source Directives support can be configured through a new option in the Code Coverage preferences. This feature is disabled by default.

<p><img src="img/eclemma_pref.png">

<h2>Features</h2>

<p>This fork adds the following:

<ul>
<li>New default filters which ignore elements of bytecode which are not useful in a coverage report:
  <ul>
  <li>Empty no args constructors including implicit no args constructors.
  <li>Default enum methods - values() and valueOf().
  <li>Synchronization exit.
  </ul>
<li>Arbitrary sections of source code can have coverage turned off using source directives.
  <ul>
  <li>Access to this feature can currently only be enabled from ant.
  </ul>
</ul>

<h2>Blog Posts</h2>

<p>Further details about this project can be found on my blog:
<ul>
<li><a href="http://mchr3k-coding.blogspot.co.uk/2013/01/improving-finally-block-handling.html">Improving Finally Block Handling  (14/01/2013)</a>
<li><a href="http://mchr3k-coding.blogspot.com/2013/01/java-bytecode-finally-blocks.html">Java Bytecode - Finally Blocks (09/01/2013)</a>
<li><a href="http://mchr3k-coding.blogspot.com/2013/01/java-code-coverage-filtering-out-noise.html">Java Code Coverage: Filtering out the noise (09/01/2013)</a>
</ul>

<h2>Clover to JaCoCo Migration</h2>

<p>Source directives are currently supported by Clover so this section discussed how to migrate
your build from Clover to JaCoCo. This example also assumes you will use offline instrumentation
which allows tools like Powermock to work.

<p>These instructions assume you store the required jacoco jars in the following locations:
<ul>
<li>lib/build/jacocoant.jar
<li>lib/test/jacocoagent.jar
</ul>

<h3>Task Definitions</h3>
<p>Clover
<pre class="prettyprint lang-xml">
&lt;taskdef resource="clovertasks" /&gt;
&lt;typedef resource="clovertypes" /&gt;
</pre>
<p>JaCoCo
<pre class="prettyprint lang-xml">
&lt;taskdef resource="org/jacoco/ant/antlib.xml"&gt;
  &lt;classpath path="lib/build/jacocoant.jar"/&gt;
&lt;/taskdef&gt;
</pre>

<h3>Instrumentation</h3>
<p>Clover
<pre class="prettyprint lang-xml">
&lt;clover-setup initString="./reports/coverage/metadata/coverage.db"&gt;
  &lt;fileset dir="./build/src" /&gt;
&lt;/clover-setup&gt;
&lt;clover-clean /&gt;
        
&lt;javac destdir="./build/classes_instr" debug="true"&gt;
  &lt;src path="./build/src" /&gt;
  &lt;classpath&gt;
    &lt;fileset dir="./lib" includes="*.jar" /&gt;
    &lt;fileset dir="./lib/test" includes="*.jar" /&gt;
  &lt;/classpath&gt;
&lt;/javac&gt;
</pre>
<p>JaCoCo
<pre class="prettyprint lang-xml">
&lt;instrument destdir="./build/classes_instr"&gt;
  &lt;fileset dir="./build/classes" includes="**/*.class"/&gt;
&lt;/instrument&gt;
</pre>

<h3>Running Tests</h3>

<p>Clover - include clover.jar in junit classpath.
<p>JaCoCo - include jacocoagent.jar in junit classpath. You also need to set a sysproperty within the junit task:
<pre class="prettyprint lang-xml">&lt;sysproperty key="jacoco-agent.destfile" file="./reports/coverage/jacoco.exec"/&gt;</pre>

<h3>Generating Reports</h3>

<p>Clover
<pre class="prettyprint lang-xml">
&lt;clover-report&gt;
  &lt;current outfile="./reports/coverage"&gt;
    &lt;format type="html" orderBy="ElementsCoveredDesc" /&gt;
  &lt;/current&gt;
  &lt;current outfile="./reports/coverage/current.xml" /&gt;
&lt;/clover-report&gt;
</pre>

<p>JaCoCo
<pre class="prettyprint lang-xml">
&lt;report&gt;
  &lt;options&gt;
    &lt;sourcedirectives/&gt;
  &lt;/options&gt;
  &lt;executiondata&gt;
    &lt;file file="./reports/coverage/jacoco.exec"/&gt;
  &lt;/executiondata&gt;
  &lt;structure name="ProjectName"&gt;
    &lt;classfiles&gt;
      &lt;fileset dir="./build/classes"/&gt;
    &lt;/classfiles&gt;
    &lt;sourcefiles encoding="UTF-8"&gt;
      &lt;fileset dir="./src"/&gt;
    &lt;/sourcefiles&gt;
  &lt;/structure&gt;
  &lt;html destdir="./reports/coverage"/&gt;
&lt;/report&gt;
</pre>

<h2>Progress</h2>

<h3>22/02/2013 (unreleased)</h3>
<ul>
<li>Complete rewrite of finally block dedup to remove line number information requirement and improve accuracy.
</ul>

<h3>08/01/2013</h3>
<ul>
<li>Merge latest JaCoCo changes, remove local offline instrumentation implementation.
</ul>

<h3>06/01/2013</h3>
<ul>
<li>Fix finally block coverage.
<li>Complete offline instrumentation.
<li>Add tests for finally block coverage, improve comments on other tests.
</ul>

<h3>16/12/2012</h3>
<ul>
<li>Get offline instrumentation working. 
<li>Fix bug in directives handling. 
<li>Ignore coverage of finally exception path.
</ul>

<h3>09/12/2012</h3>
<p>Fixed handling of source directives in light of:
<ul>
<li>Init methods can overlap line numbers of other methods.
<li>Line numbers within methods are not always visited in order when you have try/catch/finally blocks.
<li>Begin work on offline instrumentation.
</ul>

<h3>28/11/2012</h3>
<p>Initial release with new filters.
